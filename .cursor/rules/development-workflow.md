---
description: "コード開発時の必須ワークフロー: テスト、Lint、PR作成のルール"
alwaysApply: true
---

# 開発ワークフロー

このプロジェクトでは、以下の開発ワークフローを厳守してください。

## コード開発時の必須事項

### 1. テストの同時開発

- **コードを実装する際は、必ず対応するテストも同時に開発すること**
- 新しい機能や関数を追加する場合は、`tests/`ディレクトリに対応するテストファイルを作成または更新する
- テストファイルは`test_*.py`の命名規則に従う
- テストは`pytest`を使用して実装する

### 2. すべてのテストがパスすること

- **コード開発完了時、必ずすべてのテストがパスすることを確認すること**
- テストを実行するコマンド: `uv run pytest`
- テストが失敗する場合は、コードを修正するか、テストを適切に更新する
- テストがパスしない状態でコミットやPRを作成してはならない

### 3. Lintチェックが全てパスすること

- **コード開発完了時、必ずすべてのLintチェックがパスすることを確認すること**
- Lintチェックを実行するコマンド: `uv run ruff check .`
- Lintエラーがある場合は、自動修正を試みる: `uv run ruff check --fix .`
- 自動修正できない場合は、手動で修正する
- Lintチェックがパスしない状態でコミットやPRを作成してはならない

### 4. 型チェックがパスすること

- **コード開発完了時、型チェックもパスすることを確認すること**
- 型チェックを実行するコマンド: `uv run pyright`
- 型エラーがある場合は、適切に型アノテーションを追加または修正する

## Pull Request作成時の必須事項

### PR作成前の確認チェックリスト

コード開発完了時、以下のコマンドを順番に実行し、すべてが成功することを確認してください：

```bash
# 1. Lintチェック
uv run ruff check .

# 2. フォーマットチェック（必要に応じて自動修正）
uv run ruff format .

# 3. 型チェック
uv run pyright

# 4. テスト実行
uv run pytest
```

### PR作成手順

1. **Issueとの紐づけ**: PRの説明文に`Closes #<issue番号>`または`Fixes #<issue番号>`を含めること
2. **変更内容のまとめ**: PRの説明文に以下の情報を含めること
   - 変更の概要
   - 実装した機能や修正内容
   - テストの追加・変更内容
   - 動作確認結果（Lint、型チェック、テストの結果）
3. **PRコマンドの使用**: `gh pr create`コマンドを使用してPRを作成すること

### PR作成例

```bash
gh pr create \
  --title "機能名: 変更内容の簡潔な説明" \
  --body "## 概要
Issue #<番号> に対応しました。

## 変更内容
- 変更点1
- 変更点2

## テスト
- テストケースを追加
- 既存テストもすべてパス

## 動作確認
- ✅ \`uv run ruff check .\` - エラーなし
- ✅ \`uv run pyright\` - エラーなし
- ✅ \`uv run pytest\` - すべてのテストがパス

Closes #<issue番号>"
```

## 開発フローのまとめ

1. コードを実装する
2. 対応するテストを実装する
3. `uv run ruff check .` でLintチェックを実行し、エラーがあれば修正する
4. `uv run ruff format .` でフォーマットを確認・修正する
5. `uv run pyright` で型チェックを実行し、エラーがあれば修正する
6. `uv run pytest` でテストを実行し、すべてパスすることを確認する
7. すべてのチェックがパスしたら、変更をコミットする
8. Issue番号を参照しつつ、`gh pr create`コマンドでPRを作成する

## 注意事項

- **テストが失敗している状態でのコミットやPR作成は禁止**
- **Lintエラーがある状態でのコミットやPR作成は禁止**
- **型エラーがある状態でのコミットやPR作成は禁止**
- すべてのチェックがパスしてから、初めてコミット・PR作成を行うこと
